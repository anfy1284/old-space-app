# АРХИТЕКТУРА ПРОЕКТА MY-OLD-SPACE

Этот документ описывает техническую структуру и ключевые классы проекта.

---

## 1. ОБЩАЯ СТРУКТУРА

```
my-old-space/
├── drive_forms/
│   └── resources/public/
│       ├── UI_classes.js          # Базовые UI компоненты
│       └── style.css              # Глобальные стили (ВАЖНО!)
├── apps/
│   ├── organizations/             # Приложение для управления организациями
│   ├── uniListForm/               # Универсальная форма выбора записей
│   └── ...
```

---

## 2. БАЗОВЫЕ КЛАССЫ (UI_classes.js)

### DataForm (extends Form)
Базовый класс для форм с автоматическим рендерингом из JSON layout.
- `layout`: Массив описаний UI элементов.
- `controlsMap`: Map всех созданных контролов `{name: control}`.
- `table`: Ссылка на первую `DynamicTable` (устанавливается автоматически в `renderItem`).
- `_currentRecord`: Текущая выбранная запись (для синхронизации с `DynamicTable`).

### DynamicTable (extends Table)
Таблица с подгрузкой данных, SSE и кэшированием.
- `dataCache`: Кэш загруженных строк `{globalIndex: record}`.
- `firstVisibleRow`: Индекс первой видимой строки.
- `_activeRowIndex`: ЛОКАЛЬНЫЙ индекс активной строки (0-N внутри вьюпорта).
- `onRowActivate(globalIndex)`: Callback, вызываемый при активации строки.

**Важно:** Глобальный индекс записи = `firstVisibleRow + _activeRowIndex`.

---

## 3. СТИЛИ И LAYOUT (style.css)

Система использует Flexbox для управления пространством (см. [style.css](node_modules/my-old-space/drive_forms/resources/public/style.css)).
- `.ui-form-content`: Flex-контейнер (column) для элементов формы.
- `.ui-dynamictable`: Имеет `flex: 1 1 auto`, чтобы занимать свободное место.
- `.ui-group`: Группировка элементов (`horizontal` или `vertical`).

---

## 4. ПРИЛОЖЕНИЕ uniListForm

Универсальный компонент для выбора записи из любой таблицы БД.
- **Параметры открытия:**
  ```javascript
  MySpace.open('uniListForm', {
      dbTable: 'table_name',
      onSelectCallBack: (record) => { ... }
  });
  ```
- **Логика:** При активации строки в таблице `appForm._currentRecord` обновляется автоматически. При нажатии "Выбрать" используется именно это значение.

---

## 5. ПОДРОБНЫЕ ИНСТРУКЦИИ
Правила кодирования, анти-паттерны и процессы описаны в [ИНСТРУКЦИИ_ДЛЯ_AI.md](ИНСТРУКЦИИ_ДЛЯ_AI.md).
