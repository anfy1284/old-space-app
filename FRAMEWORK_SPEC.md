# ТЗ


# Техническое задание: Фреймворк "MyOldSpace" (весь проект как ядро)

## 1. Цель
Весь текущий проект переносится в отдельный NPM-пакет (например, my-old-space) для переиспользования и обновления через npm. Все файлы и папки проекта считаются частью ядра. Изменения структуры — минимальные, без переименования, если это не требуется для работы.

## 2. Концепция
- **Фреймворк**: Весь проект (включая drive_forms, drive_root, apps и т.д.) переносится в отдельный пакет.
- **Проект-потребитель**: Содержит только точку входа и минимальные настройки (например, main_server.js, server.config.json).

## 3. Структура пакета
- Перенести все существующие файлы и папки проекта в пакет без переименования, если это не мешает работе require/import.
- Внутри пакета допускается использовать текущие имена файлов и папок.
- Если потребуется, только тогда переименовывать файлы/папки для устранения конфликтов или для корректной работы require.

## 4. Архитектурные изменения
- Экспортировать функцию start(options), которая принимает путь к корню проекта и настройки.
- Все внутренние require должны быть относительными внутри пакета.
- Сервер должен раздавать статику и приложения из пакета.

## 5. План реализации
1. Создать папку пакета (например, packages/my-old-space).
2. Перенести весь проект (drive_forms, drive_root, apps и т.д.) в пакет без переименования, если это возможно.
3. Обновить только те require, которые перестанут работать из-за изменения структуры.
4. Создать package.json для пакета.
5. В корне пакета создать index.js, который экспортирует:
   - start
   - globalContext
   - eventBus
   - SequelizeInstance
   - Utilities
6. В main_server.js использовать пакет и передавать все нужные параметры.
7. Протестировать работу и опубликовать пакет.

## 6. Структура конечного проекта
```
my-new-project/
├── package.json (dependencies: "my-old-space")
├── server.config.json
├── dbSettings.json (настройки БД проекта)
├── index.js (точка входа)
// Все приложения и логика — внутри пакета my-old-space
```

### Настройки базы данных (dbSettings.json)

Каждый проект должен иметь свой файл `dbSettings.json` в корне, который определяет параметры подключения к базе данных:

```json
{
  "username": "postgres",
  "password": "your_password",
  "database": "your_project_database",
  "host": "localhost",
  "port": 5432,
  "dialect": "postgres"
}
```

**Механизм загрузки:**
1. Фреймворк сначала проверяет наличие `dbSettings.json` в корне проекта (путь передается через `start({ rootPath: __dirname })`)
2. Если файл найден, используются настройки проекта
3. Если файл не найден, используются дефолтные настройки из `packages/my-old-space/drive_root/db/dbSettings.json`

Это позволяет каждому проекту использовать свою базу данных без изменения кода фреймворка.
## 7. Требования к процессу переноса

- Копировать файлы и папки только после создания полной резервной копии исходного проекта.
- Не создавать пустые файлы-заглушки в целевой структуре пакета — переносить только реальные рабочие файлы с их содержимым.
- Если структура папок создаётся заранее, копирование файлов должно выполняться с перезаписью любых существующих файлов в целевой папке.
- После переноса обязательно проверить, что все ключевые файлы (особенно глобальные модули, такие как globalServerContext.js, eventBus.js, server.js и т.д.) содержат рабочий код, а не шаблоны или заглушки.
- После переноса выполнить автоматическую или ручную сверку контрольных сумм (или хотя бы размера файлов) между исходными и целевыми файлами для выявления потерь содержимого.
- Перед удалением исходных папок убедиться, что все файлы корректно перенесены и доступны в пакете.
- После переноса и обновления require протестировать запуск проекта и убедиться, что все функции и экспорты доступны.
